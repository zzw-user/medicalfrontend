

<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>设置我的资料</title>
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
  <link rel="stylesheet" href="../../../layuiadmin/layui/css/layui.css" media="all">
  <link rel="stylesheet" href="../../../layuiadmin/style/admin.css" media="all">
</head>
<body>

  <div class="layui-fluid">
    <div class="layui-row layui-col-space15">
      <div class="layui-col-md12">
        <div class="layui-card">
          <div class="layui-card-header">设置我的资料</div>
          <div class="layui-card-body" pad15>
            
            <div class="layui-form" lay-filter="">
              <div class="layui-form-item">
                <label class="layui-form-label">我的角色</label>
                <div class="layui-input-inline">
                  <select name="roleid" id="role" disabled lay-verify="">
                  </select> 
                </div>
                <div class="layui-form-mid layui-word-aux">当前角色不可更改为其它角色</div>
              </div>
              <form class="layui-form" id="pro" lay-filter="example">
              <div class="layui-form-item">
                <label class="layui-form-label">用户名</label>
                <div class="layui-input-inline">
                  <input type="text" name="realname"  readonly class="layui-input">
                </div>
                <div class="layui-form-mid layui-word-aux">不可修改。一般用于后台登入名</div>
              </div>
              <div class="layui-form-item">
                <label class="layui-form-label">昵称</label>
                <div class="layui-input-inline">
                  <input type="text" name="mname" lay-verify="required" autocomplete="off" placeholder="请输入昵称" class="layui-input">
                </div>
              </div>
              <div class="layui-form-item">
                <label class="layui-form-label">性别</label>
                <div class="layui-input-block">
                  <input type="radio" name="sex" value="1" title="男">
                  <input type="radio" name="sex" value="2" title="女" checked>
                </div>
              </div>

              <div class="layui-form-item">
                <label class="layui-form-label">手机</label>
                <div class="layui-input-inline">
                  <input type="text" name="phone" value="" lay-verify="phone" autocomplete="off" class="layui-input">
                </div>
              </div>
              <div class="layui-form-item">
                <label class="layui-form-label">QQ</label>
                <div class="layui-input-inline">
                  <input type="text" name="qq" value="" lay-verify="required" autocomplete="off" class="layui-input">
                </div>
              </div>
              <div class="layui-form-item">
                <label class="layui-form-label">微信</label>
                <div class="layui-input-inline">
                  <input type="text" name="wechatid" value="" lay-verify="required" autocomplete="off" class="layui-input">
                </div>
              </div>
              <div class="layui-form-item">
                <label class="layui-form-label">邮箱</label>
                <div class="layui-input-inline">
                  <input type="text" name="mailbox" value="" lay-verify="email" autocomplete="off" class="layui-input">
                </div>
              </div>
              <div class="layui-form-item">
                <label class="layui-form-label">出生日期</label>
                <div class="layui-input-inline">
                  <input type="text" name="birthday" lay-verify="required" id="test1" placeholder="yyyy-MM-dd" lay-verify="title" autocomplete="off"
                         class="layui-input">
                </div>
              </div>
              <div class="layui-form-item layui-inline">

                <div class="layui-form-item" id="addressDiv">
                  <label class="layui-form-label">地址</label>
                  <div class="layui-input-inline" style="width: 90px;" id="i" >
                    <select name="P1" lay-filter="province" id="province" style="width: 50px;">
                      <option></option>
                    </select>
                  </div>
                  <div class="layui-input-inline" style="width: 100px;">
                    <select name="C1" lay-filter="city" id="city" style="width: 50px;">
                      <option></option>
                    </select>
                  </div>
                  <div class="layui-input-inline" style="width: 100px;">
                    <select name="A1" lay-filter="area" id="area" style="width: 50px;">
                      <option></option>
                    </select>
                  </div>
                  <div class="layui-input-inline" id="addressDetail" style="width: 270px;">
                    <input id="site" type="text" name="site" style="width: 270px;"  lay-verify="title" autocomplete="off"
                           placeholder="请输入具体地址"  lay-verify="required" lay-reqtext="安装地址是必填项，岂能为空？" class="layui-input" style="width: 120%;">
                    <dl id="addressTip" class="addressDl">
                    </dl>
                  </div>
                  <input type="hidden" name="address" id="address">
                  <input type="hidden" name="mpid" id="mpid">
                </div>
              </div>
              <div class="layui-form-item">
                <div class="layui-input-block">
                  <button class="layui-btn" type="button" lay-submit lay-filter="formDemo2">确认修改</button>
                  <button type="reset" class="layui-btn layui-btn-primary">重新填写</button>
                </div>
              </div>
              </form>
            </div>
            
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="../../../layuiadmin/layui/layui.js"></script>
  <script src="http://www.jq22.com/jquery/1.11.1/jquery.min.js"></script>
  <script src="http://www.jq22.com/jquery/bootstrap-3.3.4.js"></script>
  <script src="../../../static/js/distpicker.data.js"></script>
  <script src="../../../static/js/distpicker.js"></script>
  <script src="../../../static/js/select.js" type="text/javascript" charset="utf-8"></script>
  <script src="../../../static/js/main.js"></script>
<!--  <script>
  layui.config({
    base: '../../../layuiadmin/' //静态资源所在路径
  }).extend({
    index: 'lib/index' //主入口模块
  }).use(['index', 'set']);
  </script>-->
  <script>
    layui.use(['laydate', 'laypage', 'layer', 'table', 'carousel', 'upload', 'element', 'slider', 'jquery', 'form'],
            function() {
              var laydate = layui.laydate //日期
                      ,
                      laypage = layui.laypage //分页
                      ,
                      layer = layui.layer //弹层
                      ,
                      table = layui.table //表格
                      ,
                      carousel = layui.carousel //轮播
                      ,
                      upload = layui.upload //上传
                      ,
                      element = layui.element //元素操作
                      ,
                      $ = layui.jquery,
                      form = layui.form,
                      slider = layui.slider//滑块//执行一个laydate实例
                      , pca = layui.pca;
              //常规用法
              laydate.render({
                elem: '#test1'
              });
              $.post( 'http://127.0.0.1:8080/info/getMpuser',function (result) {

                console.log(result);
                form.val('example',result);
                var str = result.address;
                var arr=new Array();
                arr=str.split(' ');

                //  $("#province").val(arr[0]);
                $("#province").val(arr[0]);
                $("#city").val(arr[1]);
                $("#area").val(arr[2]);
                $("#site").val(arr[3]);
                pca.init('select[name=P1]', 'select[name=C1]', 'select[name=A1]', arr[0], arr[1], arr[2]);

                $("#role").load('http://127.0.0.1:8080/info/getRole', function(res) {
                  const data = eval(res);
                  $(data).each(function (i,o) {
                    $("#role").append("<option value='"+o.rid+"'>"+o.rname+"</option>")
                  });
                  $("#role").val(result.roleid);
                  form.render('select');
                });
                form.on('submit(formDemo2)', function(data) {
                  var province = $("#province").val();
                  var area = $("#area").val();
                  var city= $("#city").val();
                  var site = $("#site").val();
                  var str = province+' '+city+' '+area+' '+site;
                  $("#address").val(str);
                  $.ajax({
                    url: 'http://127.0.0.1:8080/info/updateMpuser',
                    type: 'get',
                    contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
                    data: $("#pro").serialize(),
                    dataType: 'text',
                    success: function(result) {
                      if (result=="ok") {
                        layer.msg("修改成功！", function() {
                          x_admin_close()
                        })
                      } else {
                        layer.msg("修改失败！", function() {
                          x_admin_close()
                        })
                      }
                    }
                  })
                  return false;
                });
              });

            })
    /*关闭弹出框口*/
    function x_admin_close() {
      var index = parent.layer.getFrameIndex(window.name);
      parent.layer.close(index);
    }

    function getUrlParam(name) {
      var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
      r = window.location.search.substr(1).match(reg); // 匹配目标参数
      if (r != null) return decodeURI(r[2]); // 返回参数值
      return null; // 如果不存在，返回null
    }
    function c() {
      alert("mo")
    }
  </script>
</body>
</html>