<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>维修记录</title>
	</head>
    <link rel="stylesheet" href="../../../lib/layui-v2.5.5/css/layui.css">
	<link rel="stylesheet" href="../../../layuiadmin/layui/css/layui.css" media="all">
	<link rel="stylesheet" href="../../../layuiadmin/style/admin.css" media="all">
		</head>
		<body><!--
		<div class="weadmin-body" style="margin-left: 3%;">
			 <div class="layui-row">
				 <form class="layui-form layui-col-md12 we-search layui-form-pane">
				 <span style="margin-left:10px"><b>维修人：</b></span>
				 <div class="layui-inline" style="width: 150px">
				 	<input class="layui-input" placeholder="维修人" id="realname">
				 </div>
				 <span style="margin-left:10px"><b>维修地址：</b></span>
			<div class="layui-inline" style="width: 150px">
				 <input class="layui-input" placeholder="维修地址" id="address">
			</div>
					 <span style="margin-left:10px"><b>状态：</b></span>
					 <div class="layui-input-inline" style="width: 150px">
						 <select name="status" id="status" lay-verify="required">
							 <option value="0">请选择</option>
							 <option value="1">未开始</option>
							 <option value="2">处理中</option>
							 <option value="3">已完成</option>
						 </select>
					 </div>
					 <span style="margin-left:10px"><b>产品编码：</b></span>
					 <div class="layui-inline" style="width: 150px">
						 <input class="layui-input" placeholder="产品编码" id="productcoding">
					 </div>
					 <button class="layui-btn layui-bg-blue" type="button" id="sel" style="margin-left:10px">查询</button>
					 <button class="layui-btn layui-bg-blue" type="button" style="margin-left: 60px;background-color:#c2c2c2" onclick="WeAdminShow('新增','./addmaintenancerecord.html',800,600)">新增记录</button>
			</form>
			 </div>
			<script type="text/html" id="barDemo">
				<div style="height: 100px;margin-top:50px">
			  <a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="edit">修改</a>
			  <a class="layui-btn layui-btn-xs" lay-event="detail">评估</a>
			  <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
			  <a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="detail">新增故障</a>
				</div>
			</script>
			<table class="layui-table"  id="test" lay-filter="test"></table>
		</div>
	-->
		<div class="layui-fluid">
			<div class="layui-card">
				<div class="layui-form layui-card-header layuiadmin-card-header-auto" style="text-align: center;">
					<div class="layui-form-item" >
						<div class="layui-inline">
							<label class="layui-form-label">维修人员</label>
							<div class="layui-input-inline">
								<input type="text" name="realname" id="realname" lay-verify="title" autocomplete="off" class="layui-input">
							</div>
						</div>
						<div class="layui-inline">
							<label class="layui-form-label">维修地址</label>
							<div class="layui-input-inline">
								<input type="text" name="address" id="address" lay-verify="title" autocomplete="off" class="layui-input">
							</div>
						</div>
						<div class="layui-inline">
							<label class="layui-form-label">产品编号</label>
							<div class="layui-input-inline">
								<input type="text" name="coding" id="coding" lay-verify="title" autocomplete="off" class="layui-input">
							</div>
						</div>
						<div class="layui-inline">
							<label class="layui-form-label">维修状态</label>
							<div class="layui-input-inline">
								<select name="status" id="status" lay-filter="aihao">
									<option value="0">请选择</option>
									<option value="1">未开始</option>
									<option value="2">处理中</option>
									<option value="3">已完成</option>
								</select> </div>
						</div>
						<div class="layui-inline">
							<button class="layui-btn layuiadmin-btn-comm" data-type="reload" lay-submit lay-filter="formDemo" id="sel">
								<i class="layui-icon layui-icon-search layuiadmin-button-btn"></i>查询
							</button>
							<button class="layui-btn" type="reset" style="background-color:#c2c2c2">重置</button>
						</div>
					</div>

				</div>


				<div class="layui-card-body">
					<div style="padding-bottom: 10px;">
						<button class="layui-btn layui-bg-blue" type="button" style="background-color:#c2c2c2" onclick="WeAdminShow('新增','./addmaintenancerecord.html',800,600)">新增记录</button>
					</div>

					<table class="layui-table"  id="test" lay-filter="test"></table>
					<script type="text/html" id="barDemo">
						<div style="height: 100px;margin-top:50px">
							<a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="edit">修改</a>
							<a class="layui-btn layui-btn-xs" lay-event="detail">评估</a>
							<a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
							<a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="detail">新增故障</a>						</div>
					</script>
				</div>

			</div>
		</div>

		</body>
	<script src="../../../lib/layui-v2.5.5/layui.js"></script>
	<script type="text/html" id="beforeimgtmp">
		<img src="../../../static/img/{{d.beforeinstallation}}">
	</script>
	<script type="text/html" id="afterimgtmp">
		<img src="../../../static/img/{{d.afterinstallation}}">
	</script>
	<script type="text/html" id="progressTpl">
		{{#  if(d.status == 1){ }}
		<div class="layui-progress" >
			<div class="layui-progress-bar layui-bg-red" lay-percent="0%"></div>
		</div>
		{{#  } }}

		{{#  if(d.status == 2){ }}
		<div class="layui-progress" >
			<div class="layui-progress-bar layui-bg-blue"  lay-percent="50%"></div>
		</div>
		{{#  } }}
		{{#  if(d.status == 3){ }}
		<div class="layui-progress" >
			<div class="layui-progress-bar layui-bg-green"  lay-percent="100%"></div>
		</div>
		{{#  } }}
	</script>
	<script type="text/html" id="buttonTpl">
		{{#  if(d.status == 1){ }}
		<button class="layui-btn layui-btn-danger layui-btn-xs">未开始</button>
		{{#  } }}
		{{#  if(d.status == 2){ }}
		<button class="layui-btn layui-btn-normal layui-btn-xs">处理中</button>
		{{#  } }}
		{{#  if(d.status == 3){ }}
		<button class="layui-btn layui-btn layui-btn-xs">已完成</button>
		{{#  } }}
	</script>
	<style type="text/css">

		.layui-table-cell{

			text-align:center;

			height: auto;

			white-space: normal;

		}

	</style>
	<script src="../../../lib/layui-v2.5.5/layui.js"></script>
	<script>
		layui.use(['laydate', 'laypage', 'layer', 'table', 'carousel', 'upload', 'element', 'slider','jquery','form'], function() {
			var laydate = layui.laydate //日期
					, laypage = layui.laypage //分页
					, layer = layui.layer //弹层
					, table = layui.table //表格
					, carousel = layui.carousel //轮播
					, upload = layui.upload //上传
					, element = layui.element //元素操作
					, $ = layui.jquery
					, form = layui.form
					, slider = layui.slider; //滑块//执行一个laydate实例
			//执行一个 table 实例
			table.render({
				elem: '#test'
				,id:'testReload'
				,height: 450
				,width:1150
				,url: 'http://127.0.0.1:8080/Maintenancerecord/getAmendrecord' //数据接口
				,type:'get'
				,dataType:'json'
				,crossDomain:true
				,cols: [[ //表头
					{field:'rid',width:80,title:"序号"}
					, {field: 'realname',width:120, title: '维修人	'}
					, {field: 'address',width:150, title: '维修地址'}
					, {field: 'beforeinstallation',width:160, title: '维修前图片',templet:"#beforeimgtmp"}
					, {field: 'afterinstallation',width:160, title: '维修后图片',templet:"#afterimgtmp"}
					, {field: 'installationtime',width:150, title: '维修日期'}
					, {field: 'productcoding',width:150, title: '产品编码'}
					,{field:'assess',width:100,title:'评估'}
					,{field:'status',width:150,title:'维修进度',templet:"#progressTpl"}
					,{field:'status',width:100,title:'维修状态',templet:"#buttonTpl"}
					,{ fixed: 'right', align:'center',title:'操作', toolbar: '#barDemo', width:250}
				]]
				,page: true
				,done:function (res,curr,count) {
					element.render();
				}
			});
			$("#sel").on('click',function(){
				table.reload('testReload', {
					where : { // 设定异步数据接口的额外参数，任意设
						address : $("#address").val(),
						productcoding :$("#productcoding").val(),
						realname : $("#realname").val(),
						status :$("#status").val()
						// …
					},
					page : {
						curr : 1
					}
				});
			});
			$('.btnArr .layui-btn').on('click', function(){
				var type = $(this).data('type');
				active[type] ? active[type].call(this) : '';
			});
			//监听行工具事件
			table.on('tool(test)', function(obj){
				var data = obj.data;
				//console.log(obj)
				if(obj.event == 'del'){
					layer.confirm('真的删除行么', function(index){
						$.get("http://127.0.0.1:8080/Maintenancerecord/delAmendrecord?rid="+data.rid,function (ret) {
							if (ret==true){
								layer.msg("删除成功！")
								table.reload('testReload');
							}else {
								layer.msg("删除失败！")
							}
						})
					});


				} else if(obj.event == 'detail'){
					WeAdminShow('维修记录评估','./updmaintenancerecords.html?rid='+data.rid,800,600);
				}else if(obj.event == 'edit'){
					WeAdminShow('维修记录修改','./updmaintenancerecord.html?rid='+data.rid,800,600);
				}
			});

			window.WeAdminShow = function(title, url, w, h) {
				if(title == null || title == '') {
					title = false;
				};
				if(url == null || url == '') {
					url = "404.html";
				};
				if(w == null || w == '') {
					w = ($(window).width() * 0.9);
				};
				if(h == null || h == '') {
					h = ($(window).height() - 50);
				};
				layer.open({
					type: 2,
					area: [w + 'px', h + 'px'],
					fix: false, //不固定
					width:w,
					height:h,
					maxmin: true,
					shadeClose: true,
					shade: 0.4,
					title: title,
					content: url,
					success:function () {

					},end:function () {
						table.reload('testReload');
					}
				});
			}
		})
	</script>
</html>
