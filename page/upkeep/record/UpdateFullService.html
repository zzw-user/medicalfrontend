<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>保养记录修改</title>
	</head>
	<link rel="stylesheet" href="../../../lib/layui-v2.5.5/css/layui.css">
	<style>
		dl>dd{
			cursor: pointer;
			position: fixed;
		}
	</style>
	<body>
		<div class="weadmin-body">
		    <form class="layui-form" id="pro" lay-filter="example">
		        <blockquote class="layui-elem-quote">保养记录修改</blockquote>
						  <div class="layui-form-item">
						     <label class="layui-form-label">保养人员</label>
						     <div class="layui-input-inline">
						       <select name="operator" id="operator" lay-filter="aihao">
						      
						      
						       </select>
						     </div>


					   <!--    <label class="layui-form-label">保养地址：</label>
							  <div class="layui-input-inline">
								  <input type="text" name="title" required  lay-verify="required" placeholder="请输入标题" autocomplete="off" class="layui-input">
							  </div>-->
		            </div>
				<div class="layui-form-item">

					<div class="layui-form-item" id="addressDiv">
						<label class="layui-form-label">保养地址：</label>
						<div class="layui-input-inline" style="width: 90px;">
							<select name="P1" lay-filter="province" onchange="proinve()" lay-filter="province" id="province" style="width: 50px;">
								<option></option>
							</select>
						</div>
						<div class="layui-input-inline" style="width: 100px;">
							<select name="C1" lay-filter="city" id="city" lay-filter="city" style="width: 50px;">
								<option></option>
							</select>
						</div>
						<div class="layui-input-inline" style="width: 100px;">
							<select name="A1" lay-filter="area" lay-filter="area" id="area" style="width: 50px;">
								<option></option>
							</select>
						</div>
						<div class="layui-input-inline" id="addressDetail" style="width: 260px;">
							<input id="site" type="text" name="site" style="width: 260px;"  lay-verify="title" autocomplete="off"
								   placeholder="请输入具体地址" lay-verify="required" lay-reqtext="安装地址是必填项，岂能为空？" class="layui-input" style="width: 120%;">
							<dl id="addressTip" class="addressDl">
							</dl>
						</div>
					</div>
					<input type="hidden" id="address" name="address">
				</div>
		<div class="layui-form-item">
		       <label class="layui-form-label">保养日期：</label>
		       <div class="layui-input-inline">
		         <input type="text" name="installationtime" id="test1" lay-verify="date" placeholder="yyyy-MM-dd" autocomplete="off" class="layui-input">
		       </div>
		
		       <label class="layui-form-label">产品编码：</label>
			   <div class="layui-input-inline">
		         <input type="text" name="coding" id="coding" required  lay-verify="required" placeholder="请输入标题" autocomplete="off" class="layui-input">
		     
		</div>
		</div>
				<div class="layui-form-item">
				<div class="layui-upload-drag" id="beforeinstallationtest" style="width: 100px;margin-left: 14%">
					<i class="layui-icon"></i>
					<p>点击上传安装前图片</p>
					<div class="layui-hide" id="beforeinstallationdiv">
						<hr>
						<img src="" id="beforeinstallationimg" alt="上传成功后渲染" style="max-width: 100px">
					</div>
				</div>
				<input type="hidden" id="beforeinstallation" name="beforeinstallation">
				<div class="layui-upload-drag" id="afterinstallationtest" style="width: 100px;margin-left: 16%">
					<i class="layui-icon"></i>
					<p>点击上传安装后图片</p>
					<div class="layui-hide" id="afterinstallationdiv">
						<hr>
						<img src="" id="afterinstallationimg" alt="上传成功后渲染" style="max-width: 100px">
					</div>
				</div>
				</div>
				<input type="hidden" id="afterinstallation" name="afterinstallation">
				<input type="hidden" id="rid" name="rid">
		<div class="layui-form-item" pane="">
		    <label class="layui-form-label">保养状态：</label>
		    <div class="layui-input-block">
				<input type="radio" name="status" value="1" title="未开始" checked="">
				<input type="radio" name="status" value="2" title="处理中">
				<input type="radio" name="status" value="3" title="已完成">
		    </div>
		  </div>
		<div class="layui-form-item">
		
		            <div class="layui-form-item">
		               <div class="layui-input-block">
		                 <button class="layui-btn" lay-submit lay-filter="formDemo2">保存</button>
		                 <button type="reset" class="layui-btn layui-btn-primary">重置</button>
		               </div>
		             </div>
		    </form>
		</div>
	</body>
	<script src="../../../lib/layui-v2.5.5/layui.js"></script>
	<script src="http://www.jq22.com/jquery/1.11.1/jquery.min.js"></script>
	<script src="http://www.jq22.com/jquery/bootstrap-3.3.4.js"></script>
	<!--<script src="../../../static/js/distpicker.data.js"></script>-->
	<!--<script src="../../../static/js/distpicker.js"></script>-->
	<script src="../../../static/js/select.js" type="text/javascript" charset="utf-8"></script>
	<!--<script src="../../../static/js/main.js"></script>-->
	<script>
		layui.use(['laydate', 'laypage', 'layer', 'table', 'carousel', 'upload', 'element', 'slider', 'jquery', 'form','pca'],
				function() {
					var laydate = layui.laydate //日期
							,
							laypage = layui.laypage //分页
							,
							layer = layui.layer //弹层
							,
							table = layui.table //表格
							,
							carousel = layui.carousel //轮播
							,
							upload = layui.upload //上传
							,
							element = layui.element //元素操作
							,
							$ = layui.jquery,
							form = layui.form,
							slider = layui.slider //滑块//执行一个laydate实例
							,arrupload = layui.upload
							, pca = layui.pca;
					//带初始值进行初始化text
					$("#operator").load('http://127.0.0.1:8080/SendaSingleInstallation/getMpuser',function (result) {
						var data=eval(result);
						$(data).each(function (i,o) {
							$("#operator").append("<option value="+this.mpid+">"+this.realname+"</option>")
						});
						form.render("select");
					});
					var rid=getUrlParam("rid");
					$("#rid").val(rid);
					$.post( 'http://127.0.0.1:8080/maintainrecordController/getMaintainrecordByRid',{rid:rid},function (result) {
						console.log(result);
						form.val('example',result);
						var str = result.address;
						var arr=new Array();
						arr=str.split(' ');

						//  $("#province").val(arr[0]);
						$("#province").val(arr[0]);
						$("#city").val(arr[1]);
						$("#area").val(arr[2]);
						$("#site").val(arr[3]);
						pca.init('select[name=P1]', 'select[name=C1]', 'select[name=A1]', arr[0], arr[1], arr[2]);


					});

					$("#operator").change(function () {
						alert("来啦")
						$("#site").val('');
					});
					$("#city").change(function () {
						$("#site").val('');
					});
					$("#area").change(function () {
						$("#site").val('');
					});
					//拖拽上传
					upload.render({
						elem: '#beforeinstallationtest'
						,url: 'http://127.0.0.1:8080/maintainrecordController/upload' //改成您自己的上传接口
						,multiple: true
						,before: function(obj){
							//预读本地文件示例，不支持ie8
							obj.preview(function(index, file, result){
								$('#beforeinstallationimg').attr('src', result); //图片链接（base64）
								$('#beforeinstallationdiv').removeClass();


							});
						},done: function(res){
							//如果上传失败
							if(res.code > 0){
								return layer.msg('上传失败');
							}
							//上传成功
							layer.msg(res.msg);
							// alert("上传成功"+res.msg);
							$("#beforeinstallation").val(res.msg);
						}
					});
					upload.render({
						elem: '#afterinstallationtest'
						,url: 'http://127.0.0.1:8080/maintainrecordController/upload' //改成您自己的上传接口
						,multiple: true
						,before: function(obj){
							//预读本地文件示例，不支持ie8
							obj.preview(function(index, file, result){
								$('#afterinstallationimg').attr('src', result); //图片链接（base64）
								$('#afterinstallationdiv').removeClass();


							});
						},done: function(res){
							//如果上传失败
							if(res.code > 0){
								return layer.msg('上传失败');
							}
							//上传成功
							layer.msg(res.msg);
							// alert("上传成功"+res.msg);
							$("#afterinstallation").val(res.msg);
						}
					});

					//常规用法
					laydate.render({
						elem: '#test1'
					});
					form.on('submit(formDemo2)', function(data) {
						var province = $("#province").val();
						var area = $("#area").val();
						var city= $("#city").val();
						var site = $("#site").val();
						var str = province+' '+city+' '+area+' '+site;
						$("#address").val(str);
						$.ajax({
							url: 'http://127.0.0.1:8080/maintainrecordController/updateMaintainrecordByRid',
							type: 'get',
							contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
							data: $("#pro").serialize(),
							dataType: 'text',
							success: function(result) {

								if (result == "ok") {
									layer.msg("修改成功！",function() {
										x_admin_close()
									})
								} else {
									layer.msg("修改失败！", function() {
										x_admin_close()
									})
								}
							}
						})
						return false;
					});

				})
		/*关闭弹出框口*/
		function x_admin_close() {
			var index = parent.layer.getFrameIndex(window.name);
			parent.layer.close(index);
		}

		function getUrlParam(name) {
			var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
			r = window.location.search.substr(1).match(reg); // 匹配目标参数
			if (r != null) return decodeURI(r[2]); // 返回参数值
			return null; // 如果不存在，返回null
		}
		function proinve() {
			alert(123)
		}
	</script>
</html>
